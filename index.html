<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Water the Plants</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #000;
  }
  canvas {
    display: block;
  }
  #tutorial {
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    text-align: center;
    z-index: 10;
    animation: fadeIn 1s ease-in-out;
  }
  @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
</style>
</head>
<body>

<div id="tutorial">
  ðŸŒ± Swipe up to water plants.<br>
  ðŸŒž Move to catch sunlight orbs.<br>
  ðŸ’§ Keep thirst bars high to avoid dead plants.
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Asset paths
const assets = {
  bg: 'Bg.png',
  sun: 'sun.png',
  front: 'Front.png',
  back: 'Back.PNG',
  health: 'Health.PNG',
  dead: 'Dead.PNG',
  orb: 'https://upload.wikimedia.org/wikipedia/commons/4/4e/Simple_yellow_circle.svg'
};

// Sounds (web-based)
const sounds = {
  orbSpawn: new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg'),
  orbCollect: new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg')
};

// Game variables
let player = { x: canvas.width/2, y: canvas.height-150, w: 100, h: 150, img: null, facing: 'back' };
let plants = [];
let orbs = [];
let thirstDecreaseRate = 0.1;
let sunX = canvas.width - 120;
let gameTime = 60;
let tutorialShown = true;
let lastOrbTime = 0;
let images = {};
let keys = {};
let lastFrameTime = null;
let gameRunning = true;
let animationId = null;

// Load images
function loadImages(callback) {
  let loaded = 0, total = Object.keys(assets).length;
  for (let key in assets) {
    images[key] = new Image();
    images[key].src = assets[key];
    images[key].onload = () => {
      loaded++;
      if (loaded === total) callback();
    };
  }
}

// Init plants
function initPlants() {
  plants = [];
  for (let i=0; i<4; i++) {
    plants.push({
      x: 150 + i * ((canvas.width - 300)/3),
      y: canvas.height/2 + Math.random()*50,
      thirst: 100
    });
  }
}

// Create orb
function spawnOrb() {
  let x = Math.random() * (canvas.width - 50) + 25;
  orbs.push({ x, y: 50, size: 30, speed: 3 });
  sounds.orbSpawn.play();
}

// Update
function update(delta) {
  if (!gameRunning) return;

  // Move player
  if (keys['ArrowLeft']) player.x -= 5;
  if (keys['ArrowRight']) player.x += 5;
  player.x = Math.max(50, Math.min(canvas.width-50, player.x));

  // Thirst decrease
  plants.forEach(p => {
    p.thirst = Math.max(0, p.thirst - thirstDecreaseRate);
  });

  // Orbs falling
  orbs.forEach((orb, i) => {
    orb.y += orb.speed;
    if (orb.y >= player.y && Math.abs(orb.x - player.x) < 50) {
      orbs.splice(i,1);
      sounds.orbCollect.play();
      plants.forEach(p => p.thirst = Math.min(100, p.thirst + 20));
    }
  });

  // Sun movement
  sunX -= (canvas.width - 240) / (60 * (1000/delta)); 
  gameTime -= delta/1000;
  if (gameTime <= 0) endGame();

  // Orb spawn every ~5 sec
  if (Date.now() - lastOrbTime > 5000) {
    spawnOrb();
    lastOrbTime = Date.now();
  }
}

// Draw
function draw() {
  ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);
  ctx.drawImage(images.sun, sunX, 50, 80, 80);

  ctx.font = '20px Arial';
  ctx.fillStyle = 'white';
  ctx.shadowColor = 'black';
  ctx.shadowBlur = 4;
  ctx.fillText('Game by Balaji', canvas.width - 180, canvas.height - 20);

  plants.forEach(p => {
    let img = images.front;
    if (p.thirst <= 0) img = images.dead;
    else if (p.thirst <= 25) img = images.health;
    ctx.drawImage(img, p.x - 50, p.y - 100, 100, 100);

    ctx.fillStyle = 'red';
    ctx.fillRect(p.x - 30, p.y - 110, 60, 8);
    ctx.fillStyle = 'blue';
    ctx.fillRect(p.x - 30, p.y - 110, 60 * (p.thirst/100), 8);
  });

  let playerImg = player.facing === 'back' ? images.back : images.front;
  ctx.drawImage(playerImg, player.x - player.w/2, player.y - player.h/2, player.w, player.h);

  orbs.forEach(o => {
    ctx.drawImage(images.orb, o.x - o.size/2, o.y - o.size/2, o.size, o.size);
  });

  ctx.font = '24px Arial';
  ctx.fillText(`Time: ${Math.ceil(gameTime)}`, 20, 30);
}

function gameLoop(timestamp) {
  if (!lastFrameTime) lastFrameTime = timestamp;
  let delta = timestamp - lastFrameTime;
  lastFrameTime = timestamp;

  update(delta);
  draw();

  if (gameRunning) {
    animationId = requestAnimationFrame(gameLoop);
  }
}

function endGame() {
  gameRunning = false;
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'white';
  ctx.font = '48px Arial';
  ctx.fillText('Good night ðŸ’¤', canvas.width/2 - 150, canvas.height/2);
}

// Input
window.addEventListener('keydown', e => keys[e.key] = true);
window.addEventListener('keyup', e => keys[e.key] = false);

// Start after tutorial
loadImages(() => {
  initPlants();
  setTimeout(() => {
    document.getElementById('tutorial').style.display = 'none';
    lastOrbTime = Date.now();
    requestAnimationFrame(gameLoop);
  }, 5000);
});
</script>
</body>
</html>
